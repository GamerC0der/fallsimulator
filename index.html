<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&display=swap" rel="stylesheet">

<body style="background-color: lightblue; margin: 0; padding: 0;">
<style>
@keyframes fall {
  0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
  95% { opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.2); }
  100% { transform: translate(-50%, -50%) scale(1); }
}

.leaf {
  position: absolute;
  width: 40px;
  height: 40px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease;
}

.main-leaf {
  position: absolute;
  width: 200px;
  height: 200px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: none;
  cursor: pointer;
  transition: opacity 0.5s ease;
  z-index: 10;
}

.bg-leaf {
  position: absolute;
  width: 40px;
  height: 40px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease;
  opacity: 0;
}

.bg-leaf:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 8s; }
.bg-leaf:nth-child(2) { left: 25%; animation-delay: 1s; animation-duration: 10s; }
.bg-leaf:nth-child(3) { left: 40%; animation-delay: 2s; animation-duration: 9s; }
.bg-leaf:nth-child(4) { left: 55%; animation-delay: 1.5s; animation-duration: 11s; }
.bg-leaf:nth-child(5) { left: 70%; animation-delay: 3s; animation-duration: 7s; }
.bg-leaf:nth-child(6) { left: 85%; animation-delay: 0.5s; animation-duration: 12s; }
.bg-leaf:nth-child(7) { left: 15%; animation-delay: 4s; animation-duration: 8s; }
.bg-leaf:nth-child(8) { left: 60%; animation-delay: 2.5s; animation-duration: 9s; }
.bg-leaf:nth-child(9) { left: 35%; animation-delay: 0.8s; animation-duration: 10s; }
.bg-leaf:nth-child(10) { left: 75%; animation-delay: 3.2s; animation-duration: 8s; }
.bg-leaf:nth-child(11) { left: 5%; animation-delay: 1.8s; animation-duration: 12s; }
.bg-leaf:nth-child(12) { left: 90%; animation-delay: 0.3s; animation-duration: 7s; }
.bg-leaf:nth-child(13) { left: 20%; animation-delay: 4.1s; animation-duration: 9s; }
.bg-leaf:nth-child(14) { left: 65%; animation-delay: 2.7s; animation-duration: 11s; }


.leaf:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 8s; }

.modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: #2d2d3d;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    position: relative;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    font-family: 'Edu NSW ACT Cursive', cursive;
}

.modal-content h2 {
    color: #e0e0e0;
    margin-bottom: 15px;
    font-size: 24px;
}

.modal-content p {
    color: #ccc;
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 20px;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    line-height: 1;
}

.close-btn:hover {
    color: #333;
}

.got-it-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    font-family: 'Edu NSW ACT Cursive', cursive;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s ease;
}

.got-it-button:hover {
    background-color: #45a049;
}
.leaf:nth-child(2) { left: 25%; animation-delay: 1s; animation-duration: 10s; }
.leaf:nth-child(3) { left: 40%; animation-delay: 2s; animation-duration: 9s; }
.leaf:nth-child(4) { left: 55%; animation-delay: 1.5s; animation-duration: 11s; }
.leaf:nth-child(5) { left: 70%; animation-delay: 3s; animation-duration: 7s; }
.leaf:nth-child(6) { left: 85%; animation-delay: 0.5s; animation-duration: 12s; }
.leaf:nth-child(7) { left: 15%; animation-delay: 4s; animation-duration: 8s; }
.leaf:nth-child(8) { left: 60%; animation-delay: 2.5s; animation-duration: 9s; }
.leaf:nth-child(9) { left: 35%; animation-delay: 0.8s; animation-duration: 10s; }
.leaf:nth-child(10) { left: 75%; animation-delay: 3.2s; animation-duration: 8s; }
.leaf:nth-child(11) { left: 5%; animation-delay: 1.8s; animation-duration: 12s; }
.leaf:nth-child(12) { left: 90%; animation-delay: 0.3s; animation-duration: 7s; }
.leaf:nth-child(13) { left: 20%; animation-delay: 4.1s; animation-duration: 9s; }
.leaf:nth-child(14) { left: 65%; animation-delay: 2.7s; animation-duration: 11s; }
.leaf:nth-child(15) { left: 45%; animation-delay: 1.2s; animation-duration: 8.5s; }
.leaf:nth-child(16) { left: 80%; animation-delay: 3.8s; animation-duration: 9.5s; }

.gem {
  position: absolute;
  width: 50px;
  height: 50px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease, transform 0.3s ease;
  z-index: 5;
  border-radius: 50%;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}

.gem:hover {
  transform: scale(1.1);
}

.gem:nth-child(1) { left: 15%; animation-delay: 0s; animation-duration: 6s; }
.gem:nth-child(2) { left: 30%; animation-delay: 1.5s; animation-duration: 8s; }
.gem:nth-child(3) { left: 45%; animation-delay: 3s; animation-duration: 7s; }
.gem:nth-child(4) { left: 60%; animation-delay: 2s; animation-duration: 9s; }
.gem:nth-child(5) { left: 75%; animation-delay: 4s; animation-duration: 6.5s; }
.gem:nth-child(6) { left: 20%; animation-delay: 1s; animation-duration: 8.5s; }
.gem:nth-child(7) { left: 85%; animation-delay: 3.5s; animation-duration: 7.5s; }
.gem:nth-child(8) { left: 35%; animation-delay: 0.5s; animation-duration: 9s; }
.gem:nth-child(9) { left: 50%; animation-delay: 2.5s; animation-duration: 6s; }
.gem:nth-child(10) { left: 65%; animation-delay: 1.8s; animation-duration: 8s; }
</style>

<h1 style="position: absolute; top: 10px; left: 10px; font-family: 'Edu NSW ACT Cursive', cursive; margin: 0; letter-spacing: 2px;">Fall Simulator</h1>

    <div id="right-sidebar" style="position: fixed; top: 0; right: 0; width: 400px; height: 100vh; background: rgba(50, 50, 70, 0.95); border-left: 2px solid #555; padding: 20px; box-sizing: border-box; z-index: 1000;">
    <div id="leaf-counter" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 28px; color: #f0f0f0; margin-bottom: 20px;">Leaves: <span id="count">0</span></div>
    <div id="gem-counter" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 28px; color: #f0f0f0; margin-bottom: 30px; display: none;">Gems: <span id="gem-count">0</span> <img src="gem.png" alt="Gem" style="width: 25px; height: 25px; vertical-align: middle; margin-left: 5px;"></div>

    <div id="upgrades-section" style="color: #f0f0f0;">
        <div id="leaf-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666;" data-cost="10" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="leave.png" alt="Leaf" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Leaf Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+1 leaf per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">10</span> leaves</div>
        </div>

        <div id="electric-leaf-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="25" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="electric.png" alt="Electric" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Electric Leaf Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+3 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">25</span> leaves</div>
        </div>

        <div id="maple-syrup-tap" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="100" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="maplesyrup.png" alt="Maple Syrup" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Maple Syrup Tap</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+1 leaf per second bonus</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">100</span> leaves</div>
        </div>

        <div id="lawn-mower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="250" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="lawn_mower.png" alt="Lawn Mower" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Lawn Mower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+10 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">250</span> leaves</div>
        </div>

        <div id="food-section-divider" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 20px; color: #ffa500; margin: 20px 0 15px 0; text-align: center; border-bottom: 2px solid #ffa500; padding-bottom: 5px; display: none;">
            üçé Food
        </div>

        <div id="pumpkin-spice-latte" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="50" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="pumpkinspice.png" alt="Pumpkin Spice" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Pumpkin Spice Latte</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+5% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">50</span> leaves</div>
        </div>

        <div id="pumpkin-pie" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="100" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="pie.png" alt="Pie" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Pumpkin Pie</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+10% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">100</span> leaves</div>
        </div>

        <div id="candycorn" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="3" data-owned="0" data-cost-type="gems">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="candycorn.png" alt="Candy Corn" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Candy Corn</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+25% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">3</span> gems</div>
        </div>

        <div id="duration-boost-section" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; border-bottom: 1px solid #666; display: none;">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0; margin-bottom: 10px;"><img src="clock.png" alt="Clock" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Duration Boost</div>
            <div style="margin-bottom: 8px;">
                <select id="duration-select" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #666; background-color: #444; color: #f0f0f0; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 14px;">
                    <option value="1-1">1 minute - 1 gem</option>
                    <option value="5-3">5 minutes - 3 gems</option>
                    <option value="10-5">10 minutes - 5 gems</option>
                    <option value="30-10">30 minutes - 10 gems</option>
                    <option value="custom">Custom Duration</option>
                </select>
            </div>
            <div id="custom-duration-input" style="margin-bottom: 8px; display: none;">
                <input type="number" id="custom-minutes" min="1" max="1440" placeholder="Enter minutes" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #666; background-color: #444; color: #f0f0f0; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 14px;">
            </div>
            <button id="duration-boost-btn" style="width: 100%; padding: 10px; background-color: #ff9800; color: white; border: none; border-radius: 5px; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 16px; cursor: pointer; transition: background-color 0.3s ease;">Activate Boost</button>
            <div id="duration-preview" style="font-size: 12px; color: #999; margin-top: 5px; text-align: center;">Earn leaves instantly</div>
        </div>
    </div>
</div>

<img class="main-leaf" src="leave.png" alt="Main falling leaf">

<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">

<div id="food-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>üçé Introducing Food</h2>
        <p>Get boosts of up to 25% on all LPS earnings.</p>
        <button id="got-it-btn" class="got-it-button">Got it!</button>
    </div>
</div>

<div id="gem-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>üíé Gems Discovered!</h2>
        <p>You've earned enough leaves to unlock gems! These rare treasures will occasionally appear when you click on falling leaves. Click them quickly to collect them before they disappear!</p>
        <button id="gem-got-it-btn" class="got-it-button">Got it!</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainLeaf = document.querySelector('.main-leaf');
    const bgLeaves = document.querySelectorAll('.bg-leaf');
    const countDisplay = document.getElementById('count');

    let leafCount = 0;
    let passiveIncome = 0;
    let leafBlowerOwned = 0;
    let foodMultiplier = 1.0;
    let mapleSyrupBonus = 0;
    let gemCount = 0;
    let gemModalShown = false;
    const gemCountDisplay = document.getElementById('gem-count');

    countDisplay.textContent = leafCount;
    gemCountDisplay.textContent = gemCount;

    function checkGemReward() {
        if (leafCount >= 100 && Math.random() < 0.075) {
            createGem();
            return true;
        }
        return false;
    }

    function createGem() {
        const gem = document.createElement('img');
        gem.src = 'gem.png';
        gem.alt = 'Gem';
        gem.className = 'gem';
        gem.style.left = Math.random() * 80 + 10 + '%';
        gem.style.top = '0px';
        gem.style.animationDelay = Math.random() * 2 + 's';
        gem.style.animationDuration = (Math.random() * 3 + 6) + 's';

        document.body.appendChild(gem);

        gem.addEventListener('click', function() {
            this.style.animationPlayState = 'paused';
            this.style.opacity = '0';
            this.style.transform = 'scale(1.5)';

            setTimeout(() => {
                this.remove();
                gemCount += 1;
                gemCountDisplay.textContent = gemCount;

                if (gemCount === 1 && !gemModalShown) {
                    const gemModal = document.getElementById('gem-modal');
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemModal) {
                        gemModal.style.display = 'flex';
                        gemModalShown = true;
                    }
                    if (gemCounter) {
                        gemCounter.style.display = 'block';
                    }

                    const durationBoostSection = document.getElementById('duration-boost-section');
                    if (durationBoostSection) {
                        durationBoostSection.style.display = 'block';
                    }
                }
            }, 300);
        });
    }

    setInterval(() => {
        if (passiveIncome > 0 || mapleSyrupBonus > 0) {
            const totalIncome = Math.floor(passiveIncome * foodMultiplier) + mapleSyrupBonus;
            leafCount += totalIncome;
            countDisplay.textContent = leafCount;

            if (leafCount >= 100) {
                const gemCounter = document.getElementById('gem-counter');
                if (gemCounter && gemCounter.style.display === 'none') {
                    gemCounter.style.display = 'block';
                }
            }
        }
    }, 1000);
    mainLeaf.addEventListener('click', function() {
        this.style.animation = 'none';
        this.offsetHeight;
        this.style.animation = 'pulse 0.6s ease-in-out 3';
        leafCount++;
        countDisplay.textContent = leafCount;

        if (leafCount >= 100) {
            const gemCounter = document.getElementById('gem-counter');
            if (gemCounter && gemCounter.style.display === 'none') {
                gemCounter.style.display = 'block';
            }
        }

        checkGemReward();
    });

    bgLeaves.forEach(leaf => {
        leaf.addEventListener('click', function() {
            this.style.animationPlayState = 'paused';
            this.style.opacity = '0';

            setTimeout(() => {
                this.remove();
                leafCount++;
                countDisplay.textContent = leafCount;

                if (leafCount >= 100) {
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemCounter && gemCounter.style.display === 'none') {
                        gemCounter.style.display = 'block';
                    }
                }

                checkGemReward();
            }, 500);
        });
    });

    window.fallSimulator = {
        give: function(leaves) {
            const amount = parseInt(leaves);
            if (amount > 0) {
                leafCount += amount;
                countDisplay.textContent = leafCount;

                if (leafCount >= 100) {
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemCounter && gemCounter.style.display === 'none') {
                        gemCounter.style.display = 'block';
                    }
                }

                return `Added ${amount} leaves`;
            } else {
                return 'Error: Please provide a positive number';
            }
        },

        reset: function() {
            leafCount = 0;
            passiveIncome = 0;
            leafBlowerOwned = 0;
            foodMultiplier = 1.0;
            mapleSyrupBonus = 0;
            gemCount = 0;
            gemModalShown = false;
            countDisplay.textContent = leafCount;
            gemCountDisplay.textContent = gemCount;

            document.querySelectorAll('.gem').forEach(gem => gem.remove());

            document.querySelectorAll('.upgrade-item').forEach(upgrade => {
                upgrade.style.border = '';
                upgrade.style.borderBottom = '1px solid #666';
                const costType = upgrade.dataset.costType;
                const cost = upgrade.dataset.cost;
                if (costType === 'gems') {
                    upgrade.querySelector('.cost').textContent = cost + ' gems';
                } else {
                    upgrade.querySelector('.cost').textContent = cost + (cost > 0 ? ' leaves' : '');
                }
                upgrade.dataset.owned = '0';
            });

            const mapleSyrupTap = document.getElementById('maple-syrup-tap');
            const electricLeafBlower = document.getElementById('electric-leaf-blower');
            const lawnMower = document.getElementById('lawn-mower');
            const foodSectionDivider = document.getElementById('food-section-divider');
            const pumpkinSpiceLatte = document.getElementById('pumpkin-spice-latte');
            const pumpkinPie = document.getElementById('pumpkin-pie');
            const candycorn = document.getElementById('candycorn');

            if (mapleSyrupTap) mapleSyrupTap.style.display = 'none';
            if (electricLeafBlower) electricLeafBlower.style.display = 'none';
            if (lawnMower) lawnMower.style.display = 'none';
            if (foodSectionDivider) foodSectionDivider.style.display = 'none';
            if (pumpkinSpiceLatte) pumpkinSpiceLatte.style.display = 'none';
            if (pumpkinPie) pumpkinPie.style.display = 'none';
            if (candycorn) candycorn.style.display = 'none';

            const durationBoostSection = document.getElementById('duration-boost-section');
            if (durationBoostSection) durationBoostSection.style.display = 'none';

            const gemCounter = document.getElementById('gem-counter');
            if (gemCounter) gemCounter.style.display = 'none';

            return 'Game reset';
        },

        status: function() {
            const lawnMower = document.getElementById('lawn-mower');
            const electricDisabled = lawnMower && lawnMower.dataset.owned === '1';
            const candycorn = document.getElementById('candycorn');
            const durationBoostSection = document.getElementById('duration-boost-section');
            const candycornOwned = candycorn && candycorn.dataset.owned === '1';
            const durationBoostVisible = durationBoostSection && durationBoostSection.style.display !== 'none';
            return `Leaves: ${leafCount}, LPS: ${passiveIncome}${electricDisabled ? ' (Electric disabled)' : ''}, Maple Bonus: ${mapleSyrupBonus}, Multiplier: ${foodMultiplier}x, Gems: ${gemCount}, Candycorn: ${candycornOwned ? 'OWNED' : 'NOT OWNED'}, Duration Boost: ${durationBoostVisible ? 'AVAILABLE' : 'LOCKED'}`;
        },

        giveGems: function(gems) {
            const amount = parseInt(gems);
            if (amount > 0) {
                const wasZero = gemCount === 0;
                gemCount += amount;
                gemCountDisplay.textContent = gemCount;

                if (wasZero) {
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemCounter) {
                        gemCounter.style.display = 'block';
                    }
                    if (!gemModalShown) {
                        const gemModal = document.getElementById('gem-modal');
                        if (gemModal) {
                            gemModal.style.display = 'flex';
                            gemModalShown = true;
                        }
                    }

                    const durationBoostSection = document.getElementById('duration-boost-section');
                    if (durationBoostSection) {
                        durationBoostSection.style.display = 'block';
                    }
                }

                return `Added ${amount} gem${amount > 1 ? 's' : ''}`;
            } else {
                return 'Error: Please provide a positive number';
            }
        }
    };

    window.give = window.fallSimulator.give;
    window.giveGems = window.fallSimulator.giveGems;
    window.reset = window.fallSimulator.reset;
    window.status = window.fallSimulator.status;

    document.querySelectorAll('.upgrade-item').forEach(upgrade => {
        upgrade.addEventListener('click', function() {
            const cost = parseInt(this.dataset.cost);
            const upgradeType = this.id;
            const isOwned = this.dataset.owned === '1';
            const costType = this.dataset.costType;

            let canAfford = false;
            if (cost === 0 || isOwned) {
                canAfford = true;
            } else if (costType === 'gems') {
                canAfford = gemCount >= cost;
            } else {
                canAfford = leafCount >= cost;
            }

            if (canAfford) {
                if (!isOwned) {
                    if (costType === 'gems') {
                        gemCount -= cost;
                        gemCountDisplay.textContent = gemCount;
                    } else {
                        leafCount -= cost;
                        countDisplay.textContent = leafCount;
                    }
                }

                if (upgradeType === 'leaf-blower') {
                    leafBlowerOwned++;
                    passiveIncome += 1;
                    this.dataset.owned = leafBlowerOwned;

                    if (leafBlowerOwned === 1) {
                        this.style.border = '2px solid #4CAF50';
                        this.querySelector('.cost').textContent = 'OWNED';

                        const electricLeafBlower = document.getElementById('electric-leaf-blower');
                        if (electricLeafBlower) {
                            electricLeafBlower.style.display = 'block';
                        }
                    }
                } else if (upgradeType === 'maple-syrup-tap') {
                    mapleSyrupBonus += 1;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'electric-leaf-blower') {
                    const regularLeafBlower = document.getElementById('leaf-blower');
                    if (regularLeafBlower) {
                        regularLeafBlower.style.display = 'none';
                    }

                    passiveIncome = passiveIncome - 1 + 3;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';

                    const mapleSyrupTap = document.getElementById('maple-syrup-tap');
                    const lawnMower = document.getElementById('lawn-mower');
                    if (mapleSyrupTap) {
                        mapleSyrupTap.style.display = 'block';
                    }
                    if (lawnMower) {
                        lawnMower.style.display = 'block';
                    }

                    const foodModal = document.getElementById('food-modal');
                    if (foodModal) {
                        foodModal.style.display = 'flex';
                    }

                    const foodSectionDivider = document.getElementById('food-section-divider');
                    const pumpkinSpiceLatte = document.getElementById('pumpkin-spice-latte');
                    const pumpkinPie = document.getElementById('pumpkin-pie');
                    const candycorn = document.getElementById('candycorn');
                    if (foodSectionDivider) {
                        foodSectionDivider.style.display = 'block';
                    }
                    if (pumpkinSpiceLatte) {
                        pumpkinSpiceLatte.style.display = 'block';
                    }
                    if (pumpkinPie) {
                        pumpkinPie.style.display = 'block';
                    }
                    if (candycorn) {
                        candycorn.style.display = 'block';
                    }
                } else if (upgradeType === 'pumpkin-spice-latte') {
                    foodMultiplier = 1.05;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'pumpkin-pie') {
                    foodMultiplier = 1.10;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'candycorn') {
                    foodMultiplier = 1.25;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'lawn-mower') {
                    const electricLeafBlower = document.getElementById('electric-leaf-blower');
                    if (electricLeafBlower) {
                        electricLeafBlower.style.display = 'none';
                    }
                    passiveIncome = passiveIncome - 3 + 10; 

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                }
            }
        });
    });

    // Duration boost functionality
    const durationSelect = document.getElementById('duration-select');
    const durationBoostBtn = document.getElementById('duration-boost-btn');
    const durationPreview = document.getElementById('duration-preview');
    const customInput = document.getElementById('custom-duration-input');
    const customMinutes = document.getElementById('custom-minutes');

    function calculateGemCost(minutes) {
        if (minutes <= 1) return 1;
        if (minutes <= 5) return 3;
        if (minutes <= 10) return 5;
        if (minutes <= 30) return 10;
        if (minutes <= 60) return 18;
        if (minutes <= 120) return 30;
        if (minutes <= 240) return 50;
        if (minutes <= 480) return 80;
        return Math.ceil(minutes * 0.2);
    }

    function updateDurationPreview() {
        if (!durationSelect || !durationPreview) return;

        let minutes, gems;
        const selectedValue = durationSelect.value;

        if (selectedValue === 'custom') {
            const customMinValue = parseInt(customMinutes?.value) || 1;
            minutes = customMinValue;
            gems = calculateGemCost(minutes);
            const currentCPS = Math.floor(passiveIncome * foodMultiplier) + mapleSyrupBonus;
            const totalEarnings = currentCPS * (minutes * 60);

            durationPreview.textContent = `${totalEarnings.toLocaleString()} leaves (${currentCPS} CPS √ó ${minutes} min) - Cost: ${gems} gems`;

            if (durationBoostBtn) {
                durationBoostBtn.textContent = `Activate (${gems} ${gems === 1 ? 'gem' : 'gems'})`;
                durationBoostBtn.disabled = gemCount < gems;
                durationBoostBtn.style.backgroundColor = gemCount >= gems ? '#ff9800' : '#666';
                durationBoostBtn.style.cursor = gemCount >= gems ? 'pointer' : 'not-allowed';
            }
        } else {
            [minutes, gems] = selectedValue.split('-').map(Number);
            const currentCPS = Math.floor(passiveIncome * foodMultiplier) + mapleSyrupBonus;
            const totalEarnings = currentCPS * (minutes * 60);

            durationPreview.textContent = `${totalEarnings.toLocaleString()} leaves (${currentCPS} CPS √ó ${minutes} min)`;

            if (durationBoostBtn) {
                durationBoostBtn.textContent = `Activate (${gems} ${gems === 1 ? 'gem' : 'gems'})`;
                durationBoostBtn.disabled = gemCount < gems;
                durationBoostBtn.style.backgroundColor = gemCount >= gems ? '#ff9800' : '#666';
                durationBoostBtn.style.cursor = gemCount >= gems ? 'pointer' : 'not-allowed';
            }
        }
    }

    function toggleCustomInput() {
        if (!customInput) return;

        if (durationSelect?.value === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
        }
        updateDurationPreview();
    }

    if (durationSelect) {
        durationSelect.addEventListener('change', function() {
            toggleCustomInput();
        });
    }

    if (customMinutes) {
        customMinutes.addEventListener('input', function() {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 1) {
                this.value = 1;
            } else if (value > 1440) {
                this.value = 1440;
            }
            updateDurationPreview();
        });
    }

    if (durationBoostBtn) {
        durationBoostBtn.addEventListener('click', function() {
            if (!durationSelect) return;

            let minutes, gems;
            const selectedValue = durationSelect.value;

            if (selectedValue === 'custom') {
                const customMinValue = parseInt(customMinutes?.value) || 1;
                minutes = customMinValue;
                gems = calculateGemCost(minutes);
            } else {
                [minutes, gems] = selectedValue.split('-').map(Number);
            }

            const currentCPS = Math.floor(passiveIncome * foodMultiplier) + mapleSyrupBonus;

            if (gemCount >= gems) {
                const totalEarnings = currentCPS * (minutes * 60);
                leafCount += totalEarnings;
                gemCount -= gems;

                countDisplay.textContent = leafCount;
                gemCountDisplay.textContent = gemCount;

                // Show feedback
                durationPreview.textContent = `+${totalEarnings.toLocaleString()} leaves earned!`;
                durationPreview.style.color = '#4CAF50';

                setTimeout(() => {
                    durationPreview.style.color = '#999';
                    updateDurationPreview();
                }, 2000);
            }
        });
    }

    // Initialize custom input visibility and update preview
    toggleCustomInput();
    // Update preview initially and periodically
    setInterval(updateDurationPreview, 1000);

    const foodModal = document.getElementById('food-modal');
    const closeBtn = document.querySelector('.close-btn');

    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            if (foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    const gotItBtn = document.getElementById('got-it-btn');
    if (gotItBtn) {
        gotItBtn.addEventListener('click', function() {
            if (foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    if (foodModal) {
        foodModal.addEventListener('click', function(e) {
            if (e.target === foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    const gemModal = document.getElementById('gem-modal');
    const gemCloseBtn = gemModal ? gemModal.querySelector('.close-btn') : null;
    const gemGotItBtn = document.getElementById('gem-got-it-btn');

    if (gemCloseBtn) {
        gemCloseBtn.addEventListener('click', function() {
            if (gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }

    if (gemGotItBtn) {
        gemGotItBtn.addEventListener('click', function() {
            if (gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }

    if (gemModal) {
        gemModal.addEventListener('click', function(e) {
            if (e.target === gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }
});
</script>
</body>
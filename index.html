<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&display=swap" rel="stylesheet">

<body style="background-color: lightblue; margin: 0; padding: 0;">
<style>
@keyframes fall {
  0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
  95% { opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.2); }
  100% { transform: translate(-50%, -50%) scale(1); }
}

.leaf {
  position: absolute;
  width: 40px;
  height: 40px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease;
}

.main-leaf {
  position: absolute;
  width: 200px;
  height: 200px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: none;
  cursor: pointer;
  transition: opacity 0.5s ease;
  z-index: 10;
}

.bg-leaf {
  position: absolute;
  width: 40px;
  height: 40px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease;
  opacity: 0;
}

.bg-leaf:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 8s; }
.bg-leaf:nth-child(2) { left: 25%; animation-delay: 1s; animation-duration: 10s; }
.bg-leaf:nth-child(3) { left: 40%; animation-delay: 2s; animation-duration: 9s; }
.bg-leaf:nth-child(4) { left: 55%; animation-delay: 1.5s; animation-duration: 11s; }
.bg-leaf:nth-child(5) { left: 70%; animation-delay: 3s; animation-duration: 7s; }
.bg-leaf:nth-child(6) { left: 85%; animation-delay: 0.5s; animation-duration: 12s; }
.bg-leaf:nth-child(7) { left: 15%; animation-delay: 4s; animation-duration: 8s; }
.bg-leaf:nth-child(8) { left: 60%; animation-delay: 2.5s; animation-duration: 9s; }
.bg-leaf:nth-child(9) { left: 35%; animation-delay: 0.8s; animation-duration: 10s; }
.bg-leaf:nth-child(10) { left: 75%; animation-delay: 3.2s; animation-duration: 8s; }
.bg-leaf:nth-child(11) { left: 5%; animation-delay: 1.8s; animation-duration: 12s; }
.bg-leaf:nth-child(12) { left: 90%; animation-delay: 0.3s; animation-duration: 7s; }
.bg-leaf:nth-child(13) { left: 20%; animation-delay: 4.1s; animation-duration: 9s; }
.bg-leaf:nth-child(14) { left: 65%; animation-delay: 2.7s; animation-duration: 11s; }


.leaf:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 8s; }

.modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: #2d2d3d;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    position: relative;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    font-family: 'Edu NSW ACT Cursive', cursive;
}

.modal-content h2 {
    color: #e0e0e0;
    margin-bottom: 15px;
    font-size: 24px;
}

.modal-content p {
    color: #ccc;
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 20px;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    line-height: 1;
}

.close-btn:hover {
    color: #333;
}

.got-it-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    font-family: 'Edu NSW ACT Cursive', cursive;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s ease;
}

.got-it-button:hover {
    background-color: #45a049;
}

#minigame-btn:hover {
    background: linear-gradient(135deg, #777, #555);
    border-color: #888;
}

#minigame-btn:active {
    transform: scale(0.95);
}

#trick-treat-btn:hover {
    background: #ff7a47;
    transform: translateY(-2px);
}

#trick-treat-btn:active {
    transform: translateY(0);
}

#back-btn:hover {
    background: #777;
    border-color: #888;
}

#back-btn:active {
    transform: scale(0.95);
}
.leaf:nth-child(2) { left: 25%; animation-delay: 1s; animation-duration: 10s; }
.leaf:nth-child(3) { left: 40%; animation-delay: 2s; animation-duration: 9s; }
.leaf:nth-child(4) { left: 55%; animation-delay: 1.5s; animation-duration: 11s; }
.leaf:nth-child(5) { left: 70%; animation-delay: 3s; animation-duration: 7s; }
.leaf:nth-child(6) { left: 85%; animation-delay: 0.5s; animation-duration: 12s; }
.leaf:nth-child(7) { left: 15%; animation-delay: 4s; animation-duration: 8s; }
.leaf:nth-child(8) { left: 60%; animation-delay: 2.5s; animation-duration: 9s; }
.leaf:nth-child(9) { left: 35%; animation-delay: 0.8s; animation-duration: 10s; }
.leaf:nth-child(10) { left: 75%; animation-delay: 3.2s; animation-duration: 8s; }
.leaf:nth-child(11) { left: 5%; animation-delay: 1.8s; animation-duration: 12s; }
.leaf:nth-child(12) { left: 90%; animation-delay: 0.3s; animation-duration: 7s; }
.leaf:nth-child(13) { left: 20%; animation-delay: 4.1s; animation-duration: 9s; }
.leaf:nth-child(14) { left: 65%; animation-delay: 2.7s; animation-duration: 11s; }
.leaf:nth-child(15) { left: 45%; animation-delay: 1.2s; animation-duration: 8.5s; }
.leaf:nth-child(16) { left: 80%; animation-delay: 3.8s; animation-duration: 9.5s; }

.gem {
  position: absolute;
  width: 50px;
  height: 50px;
  animation: fall linear infinite;
  cursor: pointer;
  transition: opacity 0.5s ease, transform 0.3s ease;
  z-index: 5;
  border-radius: 50%;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}

.gem:hover {
  transform: scale(1.1);
}

.gem:nth-child(1) { left: 15%; animation-delay: 0s; animation-duration: 6s; }
.gem:nth-child(2) { left: 30%; animation-delay: 1.5s; animation-duration: 8s; }
.gem:nth-child(3) { left: 45%; animation-delay: 3s; animation-duration: 7s; }
.gem:nth-child(4) { left: 60%; animation-delay: 2s; animation-duration: 9s; }
.gem:nth-child(5) { left: 75%; animation-delay: 4s; animation-duration: 6.5s; }
.gem:nth-child(6) { left: 20%; animation-delay: 1s; animation-duration: 8.5s; }
.gem:nth-child(7) { left: 85%; animation-delay: 3.5s; animation-duration: 7.5s; }
.gem:nth-child(8) { left: 35%; animation-delay: 0.5s; animation-duration: 9s; }
.gem:nth-child(9) { left: 50%; animation-delay: 2.5s; animation-duration: 6s; }
.gem:nth-child(10) { left: 65%; animation-delay: 1.8s; animation-duration: 8s; }

.reset-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: transparent;
    color: #ff4444;
    border: 2px solid #ff4444;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    z-index: 1000;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.reset-btn:hover {
    color: #ff6666;
    border-color: #ff6666;
    transform: scale(1.1);
    background: rgba(255, 68, 68, 0.1);
}

.reset-btn:active {
    transform: scale(0.95);
}

.reset-modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
}

.reset-modal-content {
    background-color: #2d2d3d;
    color: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    font-family: 'Edu NSW ACT Cursive', cursive;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
}

.reset-modal-content h2 {
    color: #ff4444;
    margin-top: 0;
    font-size: 24px;
}

.reset-modal-content p {
    font-size: 18px;
    margin: 15px 0;
    color: #ccc;
}

.reset-modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
}

.reset-confirm-btn {
    background-color: #ff4444;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Edu NSW ACT Cursive', cursive;
    transition: background-color 0.3s ease;
}

.reset-confirm-btn:hover {
    background-color: #ff6666;
}

.reset-cancel-btn {
    background-color: #666;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Edu NSW ACT Cursive', cursive;
    transition: background-color 0.3s ease;
}

.reset-cancel-btn:hover {
    background-color: #777;
}
</style>

<h1 style="position: absolute; top: 10px; left: 10px; font-family: 'Edu NSW ACT Cursive', cursive; margin: 0; letter-spacing: 2px;">Fall Simulator</h1>

    <div id="right-sidebar" style="position: fixed; top: 0; right: 0; width: 400px; height: 100vh; background: rgba(50, 50, 70, 0.95); border-left: 2px solid #555; padding: 20px; box-sizing: border-box; z-index: 1000;">
    <div id="leaf-counter" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 28px; color: #f0f0f0; margin-bottom: 20px;">Leaves: <span id="count">0</span></div>
    <div id="gem-counter" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 28px; color: #f0f0f0; margin-bottom: 30px; display: none;">Gems: <span id="gem-count">0</span> <img src="gem.png" alt="Gem" style="width: 25px; height: 25px; vertical-align: middle; margin-left: 5px;"></div>

    <div style="position: absolute; top: 15px; right: 15px; z-index: 1001;">
        <button id="minigame-btn" style="display: none; background: linear-gradient(135deg, #666, #444); color: #f0f0f0; border: 2px solid #777; padding: 8px 16px; font-size: 14px; font-family: 'Edu NSW ACT Cursive', cursive; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; font-weight: bold;">
            🎮
        </button>
    </div>

    <div id="upgrades-section" style="color: #f0f0f0; max-height: 70vh; overflow-y: auto; padding-bottom: 20px; scrollbar-width: thin; scrollbar-color: #666 #444;">
        <div id="leaf-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666;" data-cost="10" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="leave.png" alt="Leaf" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Leaf Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+1 leaf per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">10</span> leaves</div>
        </div>

        <div id="electric-leaf-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="25" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="electric.png" alt="Electric" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Electric Leaf Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+3 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">25</span> leaves</div>
        </div>

        <div id="maple-syrup-tap" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="100" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="maplesyrup.png" alt="Maple Syrup" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Maple Syrup Tap</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+1 leaf per second bonus</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">100</span> leaves</div>
        </div>

        <div id="large-maple-syrup-tap" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="1000" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="largemaplesyrup.png" alt="Large Maple Syrup" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Large Maple Syrup Tap</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+2 leaves per second bonus</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">1000</span> leaves</div>
        </div>

        <div id="lawn-mower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="250" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="lawn_mower.png" alt="Lawn Mower" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Lawn Mower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+10 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">250</span> leaves</div>
        </div>

        <div id="jack-o-lantern" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="500" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="pumpkin.png" alt="Jack O'Lantern" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Jack O'Lantern</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+25 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">500</span> leaves</div>
        </div>

        <div id="snow-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="2500" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="snow.png" alt="Snow Blower" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Snow Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+50 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">2500</span> leaves</div>
        </div>

        <div id="super-snow-blower" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="7500" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="largesnow.png" alt="Super Snow Blower" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Super Snow Blower</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+100 leaves per second</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">7500</span> leaves</div>
        </div>

        <div id="food-section-divider" style="font-family: 'Edu NSW ACT Cursive', cursive; font-size: 20px; color: #ffa500; margin: 20px 0 15px 0; text-align: center; border-bottom: 2px solid #ffa500; padding-bottom: 5px; display: none;">
            🍎 Food
        </div>

        <div id="pumpkin-spice-latte" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="50" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="pumpkinspice.png" alt="Pumpkin Spice" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Pumpkin Spice Latte</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+5% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">50</span> leaves</div>
        </div>

        <div id="pumpkin-pie" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="100" data-owned="0">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="pie.png" alt="Pie" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Pumpkin Pie</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+10% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">100</span> leaves</div>
        </div>

        <div id="candycorn" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="3" data-owned="0" data-cost-type="gems">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="candycorn.png" alt="Candy Corn" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Candy Corn</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+25% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">3</span> gems</div>
        </div>

        <div id="apple-cider-press" class="upgrade-item" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; cursor: pointer; border-bottom: 1px solid #666; display: none;" data-cost="10" data-owned="0" data-cost-type="gems">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0;"><img src="applecider.png" alt="Apple Cider Press" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Apple Cider Press</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 2px;">+50% CPS boost</div>
            <div style="font-size: 13px; color: #999; margin-top: 1px;">Cost: <span class="cost">10</span> gems</div>
        </div>

        <div id="duration-boost-section" style="font-family: 'Edu NSW ACT Cursive', cursive; padding: 8px 0; margin-bottom: 12px; border-bottom: 1px solid #666; display: none;">
            <div style="font-size: 18px; font-weight: bold; color: #f0f0f0; margin-bottom: 10px;"><img src="clock.png" alt="Clock" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">Duration Boost</div>
            <div style="margin-bottom: 8px;">
                <select id="duration-select" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #666; background-color: #444; color: #f0f0f0; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 14px;">
                    <option value="1-1">1 minute - 1 gem</option>
                    <option value="5-3">5 minutes - 3 gems</option>
                    <option value="10-5">10 minutes - 5 gems</option>
                    <option value="30-10">30 minutes - 10 gems</option>
                    <option value="custom">Custom Duration</option>
                </select>
            </div>
            <div id="custom-duration-input" style="margin-bottom: 8px; display: none;">
                <input type="number" id="custom-minutes" min="1" max="1440" placeholder="Enter minutes" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #666; background-color: #444; color: #f0f0f0; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 14px;">
            </div>
            <button id="duration-boost-btn" style="width: 100%; padding: 10px; background-color: #ff9800; color: white; border: none; border-radius: 5px; font-family: 'Edu NSW ACT Cursive', cursive; font-size: 16px; cursor: pointer; transition: background-color 0.3s ease;">Activate Boost</button>
            <div id="duration-preview" style="font-size: 12px; color: #999; margin-top: 5px; text-align: center;">Earn leaves instantly</div>
        </div>
    </div>
</div>

<img class="main-leaf" src="leave.png" alt="Main falling leaf">

<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">
<img class="bg-leaf" src="leave.png" alt="Falling leaf">

<div id="food-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>🍎 Introducing Food</h2>
        <p>Get boosts of up to 25% on all LPS earnings.</p>
        <button id="got-it-btn" class="got-it-button">Got it!</button>
    </div>
</div>

<div id="gem-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>💎 Gems Discovered!</h2>
        <div style="text-align: center; margin: 20px 0;">
            <img src="gem.png" alt="Gem" style="width: 60px; height: 60px; border-radius: 50%; box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); animation: pulse 1s infinite;">
        </div>
        <p>You've earned enough leaves to unlock gems! These rare treasures will occasionally appear when you click on falling leaves. Click them quickly to collect them before they disappear!</p>
        <button id="gem-got-it-btn" class="got-it-button">Got it!</button>
    </div>
</div>

<div id="minigame-modal" class="modal" style="display: none;">
    <div class="modal-content" style="min-height: 200px; min-width: 350px; padding: 40px; text-align: center;">
        <span class="close-btn">&times;</span>
        <h2 style="color: #e0e0e0; font-size: 24px; margin: 0 0 30px 0; font-family: 'Edu NSW ACT Cursive', cursive;">Minigames</h2>

        <div style="display: flex; flex-direction: row; gap: 20px; justify-content: center; align-items: center;">
            <button id="trick-treat-btn" style="background: #ff6b35; color: white; border: none; padding: 12px 25px; font-size: 16px; font-family: 'Edu NSW ACT Cursive', cursive; border-radius: 20px; cursor: pointer; transition: all 0.3s ease;">
                🎃 Trick n Treat
            </button>

            <button id="back-btn" style="background: #666; color: #f0f0f0; border: 2px solid #777; padding: 12px 25px; font-size: 16px; font-family: 'Edu NSW ACT Cursive', cursive; border-radius: 15px; cursor: pointer; transition: all 0.3s ease;">
                ← Back
            </button>
        </div>

        <p style="color: #ccc; font-size: 14px; margin: 20px 0 0 0; text-align: center; font-family: 'Edu NSW ACT Cursive', cursive;">
            <img src="gem.png" alt="Gem" style="width: 16px; height: 16px; vertical-align: middle; margin: 0 3px;"> Unlock games with gems and earn even more diamonds!
        </p>
    </div>
</div>

<!-- Reset Button and Modal -->
<button id="reset-btn" class="reset-btn" title="Reset Game">🗑️</button>

<div id="reset-modal" class="reset-modal">
    <div class="reset-modal-content">
        <h2>🗑️ Reset Game?</h2>
        <p>This will permanently delete all your progress including:</p>
        <p>🍂 All leaves and gems</p>
        <p>🏭 All purchased upgrades</p>
        <p>📊 All achievements and unlocks</p>
        <div class="reset-modal-buttons">
            <button id="reset-confirm" class="reset-confirm-btn">Yes, Reset</button>
            <button id="reset-cancel" class="reset-cancel-btn">Cancel</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainLeaf = document.querySelector('.main-leaf');
    const bgLeaves = document.querySelectorAll('.bg-leaf');
    const countDisplay = document.getElementById('count');

    let leafCount = 0;
    let passiveIncome = 0;
    let leafBlowerOwned = 0;
    let foodMultiplier = 1.0;
    let mapleSyrupBonus = 0;
    let ciderPressBonus = 1.0;
    let gemCount = 0;
    let gemModalShown = false;
    let foodModalShown = false;
    const gemCountDisplay = document.getElementById('gem-count');

    countDisplay.textContent = leafCount;
    gemCountDisplay.textContent = gemCount;

    function showGemUI() {
        const gemCounter = document.getElementById('gem-counter');
        const durationBoostSection = document.getElementById('duration-boost-section');
        const minigameBtn = document.getElementById('minigame-btn');

        if (gemCounter) gemCounter.style.display = 'block';
        if (durationBoostSection) durationBoostSection.style.display = 'block';
        if (minigameBtn) minigameBtn.style.display = 'inline-block';
    }

    function hideAllUpgrades() {
        const upgrades = [
            'electric-leaf-blower', 'maple-syrup-tap', 'large-maple-syrup-tap', 'lawn-mower', 'jack-o-lantern', 'snow-blower', 'super-snow-blower',
            'food-section-divider', 'pumpkin-spice-latte', 'pumpkin-pie',
            'candycorn', 'apple-cider-press', 'duration-boost-section'
        ];

        upgrades.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'none';
        });
    }

    function showUpgradesForProgression(upgradeId) {
        if (upgradeId === 'leaf-blower') {
            const electricLeafBlower = document.getElementById('electric-leaf-blower');
            if (electricLeafBlower) electricLeafBlower.style.display = 'block';
        } else if (upgradeId === 'electric-leaf-blower') {
            const normalMapleSyrup = document.getElementById('maple-syrup-tap');
            const largeMapleSyrup = document.getElementById('large-maple-syrup-tap');

            if (normalMapleSyrup) normalMapleSyrup.style.display = 'block';
            if (largeMapleSyrup && normalMapleSyrup && normalMapleSyrup.dataset.owned === '1') {
                largeMapleSyrup.style.display = 'block';
            }

            const sections = ['lawn-mower', 'food-section-divider',
                           'pumpkin-spice-latte', 'pumpkin-pie', 'candycorn', 'apple-cider-press'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'block';
            });

            const foodModal = document.getElementById('food-modal');
            if (foodModal && !foodModalShown) {
                foodModal.style.display = 'flex';
                foodModalShown = true;
            }
        } else if (upgradeId === 'lawn-mower') {
            const jackOLantern = document.getElementById('jack-o-lantern');
            if (jackOLantern) jackOLantern.style.display = 'block';
        } else if (upgradeId === 'jack-o-lantern') {
            const snowBlower = document.getElementById('snow-blower');
            if (snowBlower) snowBlower.style.display = 'block';
        } else if (upgradeId === 'snow-blower') {
            const superSnowBlower = document.getElementById('super-snow-blower');
            if (superSnowBlower) superSnowBlower.style.display = 'block';
        } else if (upgradeId === 'maple-syrup-tap') {
            const largeMapleSyrupTap = document.getElementById('large-maple-syrup-tap');
            if (largeMapleSyrupTap) largeMapleSyrupTap.style.display = 'block';
        }
    }

    function loadGame() {
        const savedLeaves = localStorage.getItem('leaves');
        const savedGems = localStorage.getItem('gems');
        const savedUpgrades = localStorage.getItem('upgrade');

        if (savedLeaves) {
            leafCount = parseInt(savedLeaves);
            countDisplay.textContent = leafCount;
        }

        if (savedGems) {
            gemCount = parseInt(savedGems);
            gemCountDisplay.textContent = gemCount;

            if (gemCount > 0 && !gemModalShown) {
                showGemUI();
                gemModalShown = true;
            }
        }

        if (savedUpgrades) {
            const upgrades = JSON.parse(savedUpgrades);
            Object.keys(upgrades).forEach(upgradeId => {
                const upgrade = document.getElementById(upgradeId);
                if (upgrade) {
                    upgrade.dataset.owned = upgrades[upgradeId].owned;
                    if (upgrades[upgradeId].owned === '1') {
                        upgrade.style.border = '2px solid #4CAF50';
                        upgrade.querySelector('.cost').textContent = 'OWNED';

                        if (upgradeId === 'leaf-blower') {
                            showUpgradesForProgression('leaf-blower');
                        } else if (upgradeId === 'electric-leaf-blower') {
                            if (!gemModalShown && !foodModalShown) {
                                const foodModal = document.getElementById('food-modal');
                                if (foodModal) {
                                    foodModal.style.display = 'flex';
                                    foodModalShown = true;
                                }
                            }
                            showUpgradesForProgression('electric-leaf-blower');
                        } else if (upgradeId === 'lawn-mower') {
                            showUpgradesForProgression('lawn-mower');
                        } else if (upgradeId === 'jack-o-lantern') {
                            showUpgradesForProgression('jack-o-lantern');
                        } else if (upgradeId === 'snow-blower') {
                            const superSnowBlower = document.getElementById('super-snow-blower');
                            if (superSnowBlower) {
                                superSnowBlower.style.display = 'block';
                            }
                        } else if (upgradeId === 'maple-syrup-tap') {
                            const largeMapleSyrupTap = document.getElementById('large-maple-syrup-tap');
                            if (largeMapleSyrupTap) {
                                largeMapleSyrupTap.style.display = 'block';
                            }
                        }
                    }
                }
            });

        
            const leafBlower = document.getElementById('leaf-blower');
            if (leafBlower && leafBlower.dataset.owned === '1') {
                leafBlowerOwned = 1;
                passiveIncome += 1;
            }

            const electricLeafBlower = document.getElementById('electric-leaf-blower');
            const snowBlower = document.getElementById('snow-blower');
            const superSnowBlower = document.getElementById('super-snow-blower');

            if (electricLeafBlower && electricLeafBlower.dataset.owned === '1' && (!snowBlower || snowBlower.dataset.owned !== '1') && (!superSnowBlower || superSnowBlower.dataset.owned !== '1')) {
                passiveIncome += 2;
            }

            const lawnMower = document.getElementById('lawn-mower');
            if (lawnMower && lawnMower.dataset.owned === '1') {
                passiveIncome += 7;
            }

            const jackOLantern = document.getElementById('jack-o-lantern');
            if (jackOLantern && jackOLantern.dataset.owned === '1') {
                passiveIncome += 25;
            }

            if (snowBlower && snowBlower.dataset.owned === '1') {
                passiveIncome += 50;
                if (electricLeafBlower) {
                    electricLeafBlower.style.display = 'none';
                }
            }

            if (superSnowBlower && superSnowBlower.dataset.owned === '1') {
                passiveIncome += 100;
                if (snowBlower) {
                    snowBlower.style.display = 'none';
                }
                if (electricLeafBlower) {
                    electricLeafBlower.style.display = 'none';
                }
            } else if (snowBlower && snowBlower.dataset.owned === '1') {
                if (superSnowBlower) {
                    superSnowBlower.style.display = 'block';
                }
            }

            const mapleSyrupTap = document.getElementById('maple-syrup-tap');
            const largeMapleSyrupTap = document.getElementById('large-maple-syrup-tap');

            if (largeMapleSyrupTap && largeMapleSyrupTap.dataset.owned === '1') {
                mapleSyrupBonus += 2;
            }
            if (mapleSyrupTap && mapleSyrupTap.dataset.owned === '1') {
                mapleSyrupBonus += 1;
            }

            const pumpkinSpiceLatte = document.getElementById('pumpkin-spice-latte');
            if (pumpkinSpiceLatte && pumpkinSpiceLatte.dataset.owned === '1') {
                foodMultiplier = 1.05;
            }

            const pumpkinPie = document.getElementById('pumpkin-pie');
            if (pumpkinPie && pumpkinPie.dataset.owned === '1') {
                foodMultiplier = 1.10;
            }

            const candycorn = document.getElementById('candycorn');
            if (candycorn && candycorn.dataset.owned === '1') {
                foodMultiplier = 1.25;
            }

            const appleCiderPress = document.getElementById('apple-cider-press');
            if (appleCiderPress && appleCiderPress.dataset.owned === '1') {
                ciderPressBonus = 1.5;
            }
        }

        if (leafCount >= 100) {
            const gemCounter = document.getElementById('gem-counter');
            if (gemCounter && gemCounter.style.display === 'none') {
                gemCounter.style.display = 'block';

                const minigameBtn = document.getElementById('minigame-btn');
                if (minigameBtn && gemCount > 0) {
                    minigameBtn.style.display = 'inline-block';
                }
            }
        }

        const minigameGems = localStorage.getItem('minigameGems');
        if (minigameGems) {
            const gemsToAdd = parseInt(minigameGems);
            gemCount += gemsToAdd;
            gemCountDisplay.textContent = gemCount;
            localStorage.removeItem('minigameGems');

            if (gemCount > 0 && !gemModalShown) {
                showGemUI();
                gemModalShown = true;
            }
        }

        const savedFoodModalShown = localStorage.getItem('foodModalShown');
        if (savedFoodModalShown) {
            foodModalShown = savedFoodModalShown === 'true';
        }
    }

    window.updateGemDisplay = function(newGemCount) {
        gemCount = newGemCount;
        gemCountDisplay.textContent = gemCount;
        saveGame();
    };

    function saveGame() {
        const upgradesToSave = {};
        document.querySelectorAll('.upgrade-item').forEach(upgrade => {
            upgradesToSave[upgrade.id] = {
                owned: upgrade.dataset.owned
            };
        });

        localStorage.setItem('leaves', leafCount.toString());
        localStorage.setItem('gems', gemCount.toString());
        localStorage.setItem('upgrade', JSON.stringify(upgradesToSave));
        localStorage.setItem('foodModalShown', foodModalShown.toString());
    }

    loadGame();

    setInterval(saveGame, 3000);

    function checkGemReward() {
        if (leafCount >= 100 && Math.random() < 0.075) {
            createGem();
            return true;
        }
        return false;
    }

    function createGem() {
        const gem = document.createElement('img');
        gem.src = 'gem.png';
        gem.alt = 'Gem';
        gem.className = 'gem';
        gem.style.left = Math.random() * 80 + 10 + '%';
        gem.style.top = '0px';
        gem.style.animationDelay = Math.random() * 2 + 's';
        gem.style.animationDuration = (Math.random() * 3 + 6) + 's';

        document.body.appendChild(gem);

        gem.addEventListener('click', function() {
            this.style.animationPlayState = 'paused';
            this.style.opacity = '0';
            this.style.transform = 'scale(1.5)';

            setTimeout(() => {
                this.remove();
                gemCount += 1;
                gemCountDisplay.textContent = gemCount;

                if (gemCount === 1 && !gemModalShown) {
                    const gemModal = document.getElementById('gem-modal');
                    if (gemModal) {
                        gemModal.style.display = 'flex';
                        gemModalShown = true;
                    }
                    showGemUI();
                }
            }, 300);
        });
    }

    setInterval(() => {
        if (passiveIncome > 0 || mapleSyrupBonus > 0) {
            const totalIncome = Math.floor(passiveIncome * foodMultiplier * ciderPressBonus) + mapleSyrupBonus;
            leafCount += totalIncome;
            countDisplay.textContent = leafCount;

            if (leafCount >= 100) {
                const gemCounter = document.getElementById('gem-counter');
                if (gemCounter && gemCounter.style.display === 'none') {
                    gemCounter.style.display = 'block';

                    const minigameBtn = document.getElementById('minigame-btn');
                    if (minigameBtn && gemCount > 0) {
                        minigameBtn.style.display = 'inline-block';
                    }
                }
            }
        }
    }, 1000);
    mainLeaf.addEventListener('click', function() {
        this.style.animation = 'none';
        this.offsetHeight;
        this.style.animation = 'pulse 0.6s ease-in-out 3';
        leafCount++;
        countDisplay.textContent = leafCount;

        if (leafCount >= 100) {
            const gemCounter = document.getElementById('gem-counter');
            if (gemCounter && gemCounter.style.display === 'none') {
                gemCounter.style.display = 'block';

                const minigameBtn = document.getElementById('minigame-btn');
                if (minigameBtn && gemCount > 0) {
                    minigameBtn.style.display = 'inline-block';
                }
            }
        }

        checkGemReward();
    });

    bgLeaves.forEach(leaf => {
        leaf.addEventListener('click', function() {
            this.style.animationPlayState = 'paused';
            this.style.opacity = '0';

            setTimeout(() => {
                this.remove();
                leafCount++;
                countDisplay.textContent = leafCount;

                if (leafCount >= 100) {
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemCounter && gemCounter.style.display === 'none') {
                        gemCounter.style.display = 'block';

                        const minigameBtn = document.getElementById('minigame-btn');
                        if (minigameBtn && gemCount > 0) {
                            minigameBtn.style.display = 'inline-block';
                        }
                    }
                }

                checkGemReward();
            }, 500);
        });
    });

    window.fallSimulator = {
        give: function(leaves) {
            const amount = parseInt(leaves);
            if (amount > 0) {
                leafCount += amount;
                countDisplay.textContent = leafCount;

                if (leafCount >= 100) {
                    const gemCounter = document.getElementById('gem-counter');
                    if (gemCounter && gemCounter.style.display === 'none') {
                        gemCounter.style.display = 'block';

                        const minigameBtn = document.getElementById('minigame-btn');
                        if (minigameBtn && gemCount > 0) {
                            minigameBtn.style.display = 'inline-block';
                        }
                    }
                }

                return `Added ${amount} leaves`;
            } else {
                return 'Error: Please provide a positive number';
            }
        },

        reset: function() {
            leafCount = 0;
            passiveIncome = 0;
            leafBlowerOwned = 0;
            foodMultiplier = 1.0;
            mapleSyrupBonus = 0;
            ciderPressBonus = 1.0;
            gemCount = 0;
            gemModalShown = false;
            foodModalShown = false;
            countDisplay.textContent = leafCount;
            gemCountDisplay.textContent = gemCount;

            document.querySelectorAll('.gem').forEach(gem => gem.remove());

            document.querySelectorAll('.upgrade-item').forEach(upgrade => {
                upgrade.style.border = '';
                upgrade.style.borderBottom = '1px solid #666';
                const costType = upgrade.dataset.costType;
                const cost = upgrade.dataset.cost;
                if (costType === 'gems') {
                    upgrade.querySelector('.cost').textContent = cost + ' gems';
                } else {
                    upgrade.querySelector('.cost').textContent = cost + (cost > 0 ? ' leaves' : '');
                }
                upgrade.dataset.owned = '0';
            });

            const electricLeafBlower = document.getElementById('electric-leaf-blower');
            if (electricLeafBlower) {
                electricLeafBlower.style.display = 'block';
            }

            const superSnowBlower = document.getElementById('super-snow-blower');
            if (superSnowBlower) {
                superSnowBlower.style.display = 'none';
            }

            hideAllUpgrades();

            const gemCounter = document.getElementById('gem-counter');
            if (gemCounter) gemCounter.style.display = 'none';

            const minigameBtn = document.getElementById('minigame-btn');
            if (minigameBtn) minigameBtn.style.display = 'none';

            return 'Game reset';
        },

        status: function() {
            const lawnMower = document.getElementById('lawn-mower');
            const jackOLantern = document.getElementById('jack-o-lantern');
            const snowBlower = document.getElementById('snow-blower');
            const electricLeafBlower = document.getElementById('electric-leaf-blower');
            const electricDisabled = lawnMower && lawnMower.dataset.owned === '1';
            const electricReplaced = snowBlower && snowBlower.dataset.owned === '1';
            const candycorn = document.getElementById('candycorn');
            const appleCiderPress = document.getElementById('apple-cider-press');
            const durationBoostSection = document.getElementById('duration-boost-section');
            const largeMapleSyrupTap = document.getElementById('large-maple-syrup-tap');
            const superSnowBlower = document.getElementById('super-snow-blower');
            const candycornOwned = candycorn && candycorn.dataset.owned === '1';
            const jackOLanternOwned = jackOLantern && jackOLantern.dataset.owned === '1';
            const snowBlowerOwned = snowBlower && snowBlower.dataset.owned === '1';
            const superSnowBlowerOwned = superSnowBlower && superSnowBlower.dataset.owned === '1';
            const appleCiderPressOwned = appleCiderPress && appleCiderPress.dataset.owned === '1';
            const largeMapleSyrupOwned = largeMapleSyrupTap && largeMapleSyrupTap.dataset.owned === '1';
            const durationBoostVisible = durationBoostSection && durationBoostSection.style.display !== 'none';
            return `Leaves: ${leafCount}, LPS: ${passiveIncome}${electricDisabled ? ' (Electric disabled)' : ''}${electricReplaced ? ' (Electric replaced by snow blower)' : ''}${jackOLanternOwned ? ' (+25 jack bonus)' : ''}${snowBlowerOwned ? ' (+50 snow blower)' : ''}${superSnowBlowerOwned ? ' (+100 super snow blower)' : ''}, Maple Bonus: ${mapleSyrupBonus}${largeMapleSyrupOwned ? ' (LARGE)' : ''}, Multiplier: ${foodMultiplier}x${appleCiderPressOwned ? ' (+50% cider bonus)' : ''}, Gems: ${gemCount}, Candycorn: ${candycornOwned ? 'OWNED' : 'NOT OWNED'}, Jack O'Lantern: ${jackOLanternOwned ? 'OWNED' : 'NOT OWNED'}, Snow Blower: ${snowBlowerOwned ? 'OWNED' : 'NOT OWNED'}, Super Snow Blower: ${superSnowBlowerOwned ? 'OWNED' : 'NOT OWNED'}, Cider Press: ${appleCiderPressOwned ? 'OWNED' : 'NOT OWNED'}, Duration Boost: ${durationBoostVisible ? 'AVAILABLE' : 'LOCKED'}`;
        },

        giveGems: function(gems) {
            const amount = parseInt(gems);
            if (amount > 0) {
                const wasZero = gemCount === 0;
                gemCount += amount;
                gemCountDisplay.textContent = gemCount;

                if (wasZero) {
                    if (!gemModalShown) {
                        const gemModal = document.getElementById('gem-modal');
                        if (gemModal) {
                            gemModal.style.display = 'flex';
                            gemModalShown = true;
                        }
                    }
                    showGemUI();
                }

                return `Added ${amount} gem${amount > 1 ? 's' : ''}`;
            } else {
                return 'Error: Please provide a positive number';
            }
        }
    };

    window.give = window.fallSimulator.give;
    window.giveGems = window.fallSimulator.giveGems;
    window.reset = window.fallSimulator.reset;
    window.status = window.fallSimulator.status;

    document.querySelectorAll('.upgrade-item').forEach(upgrade => {
        upgrade.addEventListener('click', function() {
            const cost = parseInt(this.dataset.cost);
            const upgradeType = this.id;
            const isOwned = this.dataset.owned === '1';
            const costType = this.dataset.costType;

            let canAfford = false;
            if (cost === 0 || isOwned) {
                canAfford = true;
            } else if (costType === 'gems') {
                canAfford = gemCount >= cost;
            } else {
                canAfford = leafCount >= cost;
            }

            if (canAfford) {
                if (!isOwned) {
                    if (costType === 'gems') {
                        gemCount -= cost;
                        gemCountDisplay.textContent = gemCount;
                    } else {
                        leafCount -= cost;
                        countDisplay.textContent = leafCount;
                    }
                }

                if (upgradeType === 'leaf-blower') {
                    leafBlowerOwned++;
                    passiveIncome += 1;
                    this.dataset.owned = leafBlowerOwned;

                    if (leafBlowerOwned === 1) {
                        this.style.border = '2px solid #4CAF50';
                        this.querySelector('.cost').textContent = 'OWNED';

                        const electricLeafBlower = document.getElementById('electric-leaf-blower');
                        if (electricLeafBlower) {
                            electricLeafBlower.style.display = 'block';
                        }
                    }
                } else if (upgradeType === 'maple-syrup-tap') {
                    mapleSyrupBonus += 1;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';

                    const largeMapleSyrupTap = document.getElementById('large-maple-syrup-tap');
                    if (largeMapleSyrupTap) {
                        largeMapleSyrupTap.style.display = 'block';
                    }
                } else if (upgradeType === 'large-maple-syrup-tap') {
                    mapleSyrupBonus += 2;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'electric-leaf-blower') {
                    const regularLeafBlower = document.getElementById('leaf-blower');
                    if (regularLeafBlower) {
                        regularLeafBlower.style.display = 'none';
                    }

                    const snowBlower = document.getElementById('snow-blower');
                    if (!snowBlower || snowBlower.dataset.owned !== '1') {
                        passiveIncome = passiveIncome - 1 + 3;
                    } else {
                        passiveIncome = passiveIncome - 1;
                    }

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';

                    showUpgradesForProgression('electric-leaf-blower');
                } else if (upgradeType === 'pumpkin-spice-latte') {
                    foodMultiplier = 1.05;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'pumpkin-pie') {
                    foodMultiplier = 1.10;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'candycorn') {
                    foodMultiplier = 1.25;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'apple-cider-press') {
                    ciderPressBonus = 1.5;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'lawn-mower') {
                    const electricLeafBlower = document.getElementById('electric-leaf-blower');
                    if (electricLeafBlower) {
                        electricLeafBlower.style.display = 'none';
                    }
                    passiveIncome = passiveIncome - 3 + 10;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';

                    const jackOLantern = document.getElementById('jack-o-lantern');
                    if (jackOLantern) {
                        jackOLantern.style.display = 'block';
                    }
                } else if (upgradeType === 'jack-o-lantern') {
                    passiveIncome += 25;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                } else if (upgradeType === 'snow-blower') {
                    const electricLeafBlower = document.getElementById('electric-leaf-blower');
                    if (electricLeafBlower) {
                        electricLeafBlower.style.display = 'none';
                    }
                    passiveIncome = passiveIncome - 3 + 50;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';

                    const superSnowBlower = document.getElementById('super-snow-blower');
                    if (superSnowBlower) {
                        superSnowBlower.style.display = 'block';
                    }
                } else if (upgradeType === 'super-snow-blower') {
                    const electricLeafBlower = document.getElementById('electric-leaf-blower');
                    const snowBlower = document.getElementById('snow-blower');

                    if (snowBlower) {
                        snowBlower.style.display = 'none';
                    }
                    if (electricLeafBlower) {
                        electricLeafBlower.style.display = 'none';
                    }

                    passiveIncome = passiveIncome - 50 + 100;

                    this.style.border = '2px solid #4CAF50';
                    this.querySelector('.cost').textContent = 'OWNED';

                    this.dataset.owned = '1';
                }
            }
        });
    });

    const durationSelect = document.getElementById('duration-select');
    const durationBoostBtn = document.getElementById('duration-boost-btn');
    const durationPreview = document.getElementById('duration-preview');
    const customInput = document.getElementById('custom-duration-input');
    const customMinutes = document.getElementById('custom-minutes');

    function calculateGemCost(minutes) {
        if (minutes <= 1) return 1;
        if (minutes <= 5) return 3;
        if (minutes <= 10) return 5;
        if (minutes <= 30) return 10;
        if (minutes <= 60) return 18;
        if (minutes <= 120) return 30;
        if (minutes <= 240) return 50;
        if (minutes <= 480) return 80;
        return Math.ceil(minutes * 0.2);
    }

    function updateDurationPreview() {
        if (!durationSelect || !durationPreview) return;

        let minutes, gems;
        const selectedValue = durationSelect.value;

        if (selectedValue === 'custom') {
            const customMinValue = parseInt(customMinutes?.value) || 1;
            minutes = customMinValue;
            gems = calculateGemCost(minutes);
            const currentCPS = Math.floor(passiveIncome * foodMultiplier * ciderPressBonus) + mapleSyrupBonus;
            let totalEarnings = currentCPS * (minutes * 60);

            if (currentCPS > 2500) {
                totalEarnings = Math.floor(totalEarnings / 2);
            }

            durationPreview.textContent = `${totalEarnings.toLocaleString()} leaves (${currentCPS} CPS × ${minutes} min${currentCPS > 2500 ? ' - 50% boost' : ''}) - Cost: ${gems} gems`;

            if (durationBoostBtn) {
                durationBoostBtn.textContent = `Activate (${gems} ${gems === 1 ? 'gem' : 'gems'})`;
                durationBoostBtn.disabled = gemCount < gems;
                durationBoostBtn.style.backgroundColor = gemCount >= gems ? '#ff9800' : '#666';
                durationBoostBtn.style.cursor = gemCount >= gems ? 'pointer' : 'not-allowed';
            }
        } else {
            [minutes, gems] = selectedValue.split('-').map(Number);
            const currentCPS = Math.floor(passiveIncome * foodMultiplier * ciderPressBonus) + mapleSyrupBonus;
            let totalEarnings = currentCPS * (minutes * 60);

            if (currentCPS > 2500) {
                totalEarnings = Math.floor(totalEarnings / 2);
            }

            durationPreview.textContent = `${totalEarnings.toLocaleString()} leaves (${currentCPS} CPS × ${minutes} min${currentCPS > 2500 ? ' - 50% boost' : ''})`;

            if (durationBoostBtn) {
                durationBoostBtn.textContent = `Activate (${gems} ${gems === 1 ? 'gem' : 'gems'})`;
                durationBoostBtn.disabled = gemCount < gems;
                durationBoostBtn.style.backgroundColor = gemCount >= gems ? '#ff9800' : '#666';
                durationBoostBtn.style.cursor = gemCount >= gems ? 'pointer' : 'not-allowed';
            }
        }
    }

    function toggleCustomInput() {
        if (!customInput) return;

        if (durationSelect?.value === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
        }
        updateDurationPreview();
    }

    if (durationSelect) {
        durationSelect.addEventListener('change', function() {
            toggleCustomInput();
        });
    }

    if (customMinutes) {
        customMinutes.addEventListener('input', function() {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 1) {
                this.value = 1;
            } else if (value > 1440) {
                this.value = 1440;
            }
            updateDurationPreview();
        });
    }

    if (durationBoostBtn) {
        durationBoostBtn.addEventListener('click', function() {
            if (!durationSelect) return;

            let minutes, gems;
            const selectedValue = durationSelect.value;

            if (selectedValue === 'custom') {
                const customMinValue = parseInt(customMinutes?.value) || 1;
                minutes = customMinValue;
                gems = calculateGemCost(minutes);
            } else {
                [minutes, gems] = selectedValue.split('-').map(Number);
            }

            const currentCPS = Math.floor(passiveIncome * foodMultiplier * ciderPressBonus) + mapleSyrupBonus;

            if (gemCount >= gems) {
                let totalEarnings = currentCPS * (minutes * 60);

                if (currentCPS > 2500) {
                    totalEarnings = Math.floor(totalEarnings / 2);
                }

                leafCount += totalEarnings;
                gemCount -= gems;

                countDisplay.textContent = leafCount;
                gemCountDisplay.textContent = gemCount;

                durationPreview.textContent = `+${totalEarnings.toLocaleString()} leaves earned!`;
                durationPreview.style.color = '#4CAF50';

                setTimeout(() => {
                    durationPreview.style.color = '#999';
                    updateDurationPreview();
                }, 2000);
            }
        });
    }

    toggleCustomInput();
    setInterval(updateDurationPreview, 1000);

    const foodModal = document.getElementById('food-modal');
    const closeBtn = document.querySelector('.close-btn');

    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            if (foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    const gotItBtn = document.getElementById('got-it-btn');
    if (gotItBtn) {
        gotItBtn.addEventListener('click', function() {
            if (foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    if (foodModal) {
        foodModal.addEventListener('click', function(e) {
            if (e.target === foodModal) {
                foodModal.style.display = 'none';
            }
        });
    }

    const gemModal = document.getElementById('gem-modal');
    const gemCloseBtn = gemModal ? gemModal.querySelector('.close-btn') : null;
    const gemGotItBtn = document.getElementById('gem-got-it-btn');

    if (gemCloseBtn) {
        gemCloseBtn.addEventListener('click', function() {
            if (gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }

    if (gemGotItBtn) {
        gemGotItBtn.addEventListener('click', function() {
            if (gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }

    if (gemModal) {
        gemModal.addEventListener('click', function(e) {
            if (e.target === gemModal) {
                gemModal.style.display = 'none';
            }
        });
    }

    const minigameBtn = document.getElementById('minigame-btn');
    const minigameModal = document.getElementById('minigame-modal');
    const minigameModalClose = minigameModal ? minigameModal.querySelector('.close-btn') : null;
    const trickTreatBtn = document.getElementById('trick-treat-btn');
    const backBtn = document.getElementById('back-btn');

    if (minigameBtn) {
        minigameBtn.addEventListener('click', function() {
            if (minigameModal) {
                minigameModal.style.display = 'flex';
            }
        });
    }

    if (minigameModalClose) {
        minigameModalClose.addEventListener('click', function() {
            if (minigameModal) {
                minigameModal.style.display = 'none';
            }
        });
    }

    if (backBtn) {
        backBtn.addEventListener('click', function() {
            if (minigameModal) {
                minigameModal.style.display = 'none';
            }
        });
    }

    if (trickTreatBtn) {
        trickTreatBtn.addEventListener('click', function() {
            window.location.href = '/minigame';
        });
    }

    if (minigameModal) {
        minigameModal.addEventListener('click', function(e) {
            if (e.target === minigameModal) {
                minigameModal.style.display = 'none';
            }
        });
    }

    const resetBtn = document.getElementById('reset-btn');
    const resetModal = document.getElementById('reset-modal');
    const resetConfirm = document.getElementById('reset-confirm');
    const resetCancel = document.getElementById('reset-cancel');

    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            resetModal.style.display = 'flex';
        });
    }

    if (resetConfirm) {
        resetConfirm.addEventListener('click', function() {
            window.fallSimulator.reset();
            resetModal.style.display = 'none';
        });
    }

    if (resetCancel) {
        resetCancel.addEventListener('click', function() {
            resetModal.style.display = 'none';
        });
    }

    if (resetModal) {
        resetModal.addEventListener('click', function(e) {
            if (e.target === resetModal) {
                resetModal.style.display = 'none';
            }
        });
    }
});
</script>
</body>